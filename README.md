# CPort - Calmira Ports

cport - менеджер системы портов, следующий философии UNIX Way. Пришёл на смену громоздкому и нестабильному `port-utils`. Входит в состав CABS (Calmira Automated Build System). Использует Port API и libcport для управления как всей системой портов в целом, так и отдельными портами.

## Причины появления

До недавнего времени в дистрибутиве Calmira GNU/Linux не было системы управления программным обеспечением кроме системы портов, содержащей инструкции для сборки пакетов из исходного кода. Система портов была очень далека от идеала, ведь в ней не было обработки зависимостей и многих других возможностей.

Чтобы исправить это, сначала была создана утилита `port-utils`, которая, поначалу, умела только обновлять СП до актуальной версии. Потом она "научилась" устанавливать и удалять порты. Но у `port-utils` было несколько недостатков, среди которых можно отметить монолитность, раздутость кода и нестабильность работы утилиты.

Поэтому на смену неудачной `port-utils` был написан `cport` - улучшенная модульная утилита, использующая Port API для управления системой портов. В утилиту было добавлено несколько новых возможностей и улучшений.

## TODO

- [X] Установка порта (в т.ч. и нескольких портов за раз);
- [X] Удаление порта (в т.ч. и нескольких портов за раз);
- [X] Просмотр информации о порте;
- [X] Добавление и удаление порта в чёрный список (если порт находится в чёрном списке, то его невозможно установить или удалить);
- [X] Обработка приоритета порта (например, если приоритет системный, то `cport` при попытке удаления такого порта выводит сообщение об ошибке);
- [ ] Поиск портов среди всех присутствующих в системе и всех установленных;
- [ ] Обновление системы портов до актуальной версии;
    - [ ] Вывод сведений об изменениях в системе портов;
    - [ ] Переключение между ветками.
- [ ] Средство для настройки утилиты без пользовательского редактирования конфигурационных файлов.
    - [ ] Настройка основных параметров;
    - [ ] Настройка `sources.list` - файла с описанием параметров канала обновлений и релиза, для которого устанавливать обновления.
- [X] Анализ времени сборки пакета в SBU.
- [ ] Возможность сборки нового формата портов.
- [ ] Переход на использование `libcoport` (обёртки для Port API) вместо обычного Port API.

## Строение

В отличие от предыдущего `port-utils`, у `cport` модульное строение. Для работы с системой портов был создан Port API.

### Модули

- `cp_default.py` - общие функции, предназначенные для работы во всех модулях ниже. К функциям можно отнести логирование, работа с базой данных и пр.
- `cp_info.py` - функции для просмотра информации о порте.
- `cp_install.py` - функции для сборки порта из исходного кода.
- `cp_remove.py` - функции для удаления установленного порта из системы.

## Использование

```bash
cport [-h] [--install INSTALL [INSTALL ...]] [--remove REMOVE [REMOVE ...]]
      [-f FLAGS] [--info INFO] [--blacklist.add ADD_BLACKLIST]
      [--blacklist.remove REMOVE_BLACKLIST] [--blacklist.fetch FETCH_BLACKLIST] [-v]
```

## Опции

- `--install`, `-i` - установка порта;
    - `--flags`, `-f` - передача определённых флагов компилятору при сборке (**ЭКСПЕРИМЕНТАЛЬНО**);
- `--remove`, `-r` - удаление порта;
- `--info`, `-I` - просмотр информации о порте;
- `--blacklist.add` - добавить порт в чёрный список;
- `--blacklist.remove` - удалить порт из чёрного списка;
- `--blacklist.fetch` - проверить, добавлен ли указанный порт в чёрный список;
- `--version`, `-v` - версия;
- `--help`, `-h` - краткая справка.