# Концепт строения новой системы портов

## Предназначение

Более удобное управление системой портов с помощью `cport`.

## Сравнение

### Строение старой системы портов

```
/usr/ports/base/editors/vim
|--- config.json # Конфигурационный файл
|--- install     # Инструкции по установке
|--- remove      # Инструкции по удалению
```

### Строение новой системы портов

```
/usr/ports/base/editors/vim
|--- config.json    # Конфигурационный файл
|--- resources.conf # Дополнительная конфигурация для cport
|--- install        # Инструкции по установке
|--- files.list     # Список файлов, которые установит порт в систему
|--- README.md      # Информация о порте, взятая из config.json
```

## Описание новых файлов

### `resources.conf`

В этом файле содержится дополнительная информация о порте для менеджера `cport`. Строение файла:

```json
{
    "resources": {
        "url": "https://lx4u.ru/downloads/packages/vim-8.2.3665.tar.gz",
        "file": "vim-8.2.3665.tar.gz",
        "directory": "vim-8.2.3665"
    },
    "flags": [
        "setup"
    ]
}
```

В секции `resources` содержится информация для установки порта.

- `url` содержит ссылку для скачивания архива с исходным кодом.
- `file` - файл, который нужно распаковать после скачивания.
- `directory` - распакованная из `file` директория с исходным кодом.

В секции `flags` содержатся дополнительные аргументы и флаги, которые будут переданы инструкциям по сборке (`install`) как аргумент `$1`. Это могут быть флаги компилятора, дополнительные параметры и прочие. Формат строки с описанием флага или аргумента:

```json
"flags": [
    "флаг/аргумент1",
    "флаг/аргумент2",
    ...
]
```

Например:

```ini
    "flags": [
        "setup"
    ]
```

### `files.list`

Здесь содержится список всех файлов, которые будут установлены портом. Например, есть пакет `base/test`, который устанавливает несколько файлов:

- `/usr/bin/test` - бинарный файл;
- `/usr/share/test` - директория;
- `/etc/test.conf` - конфигурационный файл.

Значит, содержимое файла `files.list` будет таким:

```
/usr/bin/test
/usr/share/test
/etc/test.conf
```

Содержимое этого файла может пригодиться в следующих случаях:

- **При удалении порта.** В данном случае необходимость в файле `remove` отпадает. Кроме того, повысится скорость удаления, так как не потребуется скачивать архив с исходным кодом и выполнять прочие подобные операции. Удаление будет производиться средствами `cport`;
- **При просмотре информации о порте.** В таком случае возможен вывод сведений о файлах порта;
- **При поиске порта по определённым файлам.** Например, в `cport` можно реализовать механизм поиска порта по определённым установленным файлам.

### `README.md`

На данный момент файл `README.md` уже присутствует в старой системе портов, но он требует значительной доработки. Структура этого файла:

```markdown
# {имя порта}

{описание порта}

* **{сопровождающий порта}**
* **{домашняя страница}**
* **{приоритет}**

## Зависимости

* **{необходимые}**
* **{runtime}**
* **{для тестирования}**
* **{опциональные}**
* **{рекомендуемые}**
* **{установлен перед ними}**
* **{конфликтует с}**

## Установленные файлы (краткий список)

* **{бинарники}**
* **{библиотеки}**
* **{директории}**
```

Новая структура должна быть такой:

```markdown
# {имя порта}

{описание порта}

* **{сопровождающий порта}**
* **{домашняя страница}**
* **{приоритет}**

## Зависимости

* **{необходимые}**
* **{runtime}**
* **{для тестирования}**
* **{опциональные}**
* **{рекомендуемые}**
* **{установлен перед ними}**
* **{конфликтует с}**

## Установленные файлы (краткий список)

* **{бинарники}**
* **{библиотеки}**
* **{директории}**

## Возможные аргументы командной строки или флаги компилятора

Дополнительные аргументы командной строки или флаги компилятора передаются сборочным инструкциям с помощью ключа `--flags`. Доп. аргументы могут изменять процесс сборки и настройки порта, либо обеспечивать бОльший контроль.

- аргумент1;
- аргумент2;
...
```