<h align="center"><br>Code Style Guide<br><hr><br>Руководство по стилю кода</h1>
<hr>

<h2 id="toc">Содержание</h2>

<ul>
	<li><a href="#toc">Содержание</a></li>
	<li><a href="#intro">Введение</a></li>
	<li><a href="#base">Базовые сведения</a></li>
	<ul>
		<li><a href="#code">Стиль исходного кода</a></li>
		<li><a href="#messages">Стиль сообщений</a></li>
	</ul>
</ul>

<h2 id="intro">Введение</h2>

На данный момент Python является основным сценарным языком программирования в
Calmira GNU/Linux(-libre) Developers Team. Это краткое руководство показывает,
что можно делать в программах, написаных на этом ЯП, и что нельзя.

<h2 id="base">Базовые сведения</h2>

В данном разделе приведены сведения о стиле исходного кода. Начиная с размеров
отступов, заканчивая параметрами текстового редактора.

<h3 id="code">Стиль кода</h3>

1. Отступы должны создаваться исключительно пробелами;
2. Размер отступов всегда должен равняться четырём;
3. Все необходимые переменные, которые используются в программе, должны быть
   объявлены в начале тела функции/скрипта.
4. В каждый скрипт должен быть вставлен шебанг: `#!/usr/bin/python3`. Именно в
   ту директорию устанавливается исполняемый двоичный файл интерпретатора
   python.
5. В коде функций по возможности использовать аннотации типов. Это будет
   полезным при разборе кода новыми участниками, а также избавит авторов
   документации к коду от необходимости указывать требуемые типы данных.
6. В случае ошибок, исключительных ситуаций, непонятного поведения и пр.
   используйте вызов соответствующих исключений.
7. Используйте f-строки, что улучшает читабельность кода.

Плохой код:

```python
#!/bin/python

def func(a, b):
	print(a*b)
	string = a * b
	return string

a = func("Hello", 10)
```

Хороший код:

```python
#!/usr/bin/python3

def func(a: str, b: int) -> str:
	string = a * b
	print(string)

	return string

a = func("Hello", 10)
```

В плохом примере есть следующие недочёты:

1. Неправильный шебанг. В дистрибутиве Calmira GNU/Linux(-libre) исполняемый
   двоичный файл интерпретатора Python располагается по пути `/usr/bin/python3`.
2. Не используются аннотации типов.
3. `print(a*b)`. Во-первых, между переменными и оператором умножения нет
   пробела, что ухудшает читабельность кода, во-вторых, умножение `a` на `b`
   производится в строке ниже.
4. Весь код "в куче". Вставляйте пустые строки между ветвлениями, циклами,
   функциями, `return`'ами, `yield`'ами и прочими конструкциями.

Плохой код:

```python
#!/usr/bin/python3

...

ALLOWED_USAGE = 100
MIN_SIZE = 50

def check_usage(size: int) -> bool:
	usage_all = cdf.get_usage_all()
	error_message = "The minimum value of 'size' should be " + MIN_SIZE
	
	if size < MIN_SIZE:
		print(error_message)
		return False
	
	.......
```

Хороший код:

```python
#!/usr/bin/python3

...

ALLOWED_USAGE = 100
MIN_SIZE = 50

def check_usage(size: int) -> bool:
	usage_all = cdf.get_usage_all()

	if size < MIN_SIZE:
		raise ValueError(f"The minimum value of 'size' should be {MIN_SIZE}")
	
	.........
```

В плохом коде используется непонятная конструкция `return False` в случае
передачи недопустимого значения. Использование исключений упростит обработку
таких ситуаций, а в некоторых случаях упростит поиск и исправление багов в
программе. Также здесь не нужно вызывать функцию `print()` для отображения
сообщений об ошибках.

Если даже и требуется вывести в консоль сообщение об ошибке, то намного лучше
использовать конструкции подобные этой:

```python
error_prefix = "[\033[31m!\033[0m]"
print(f"{error_prefix} {error_message}", file=sys.stderr)
```

Во-первых, в примере плохого кода не изменено значение аргумента `file` функции
`print()`, поэтому сообщения об ошибках по умолчанию выводятся в потоке
стандартного вывода (stdout), а не в потоке stderr. Во-вторых, для выделения
ошибок можно использовать выделение цветом (например, ошибки должны выделяться
красным цветом), либо с помощью каких-либо других опознавательных знаков.
Например, в cport используется следующая конструкция:

```
[!] error_message
```

Цветом выделяется только восклицательный знак. В принципе, эта же конструкция
отражена и в предыдущем примере.

```python
error_prefix = "[\033[31m!\033[0m]"
print(f"{error_prefix} {error_message}", file=sys.stderr)
```

<h3 id="messages">Стиль сообщений</h3>

В выводе сообщений в консоль программа должна быть краткой и "неразговорчивой".
Требуется выводить минимум сообщений, и все из них должны быть *полезны*
пользователю.

Важно понимать различие сообщений, предназначенных для пользователя, и
предназначенных для разработчика. В первом случае сообщений должно быть минимум.
Во втором случае сообщений вообще быть не должно (не считая debug-сообщений,
которые должны быть по умолчанию отключены).
